import{_ as e,I as t,J as a,K as o,n as i,k as r,p as s,q as n,v as l,b as c,L as u,M as p,N as d,O as g,j as h,P as m,c as f,l as v,x as w}from"./index.js";import{M as y,S as b}from"./index3.js";var S={zh:{hint:"点击，或拖动图片至此处",loading:"正在上传……",noSupported:"浏览器不支持该功能，请使用IE10以上或其他现在浏览器！",success:"上传成功",fail:"图片上传失败",preview:"头像预览",btn:{off:"取消",close:"关闭",back:"上一步",save:"保存"},error:{onlyImg:"仅限图片格式",outOfSize:"单文件大小不能超过 ",lowestPx:"图片最低像素为（宽*高）："}},"zh-tw":{hint:"點擊，或拖動圖片至此處",loading:"正在上傳……",noSupported:"瀏覽器不支持該功能，請使用IE10以上或其他現代瀏覽器！",success:"上傳成功",fail:"圖片上傳失敗",preview:"頭像預覽",btn:{off:"取消",close:"關閉",back:"上一步",save:"保存"},error:{onlyImg:"僅限圖片格式",outOfSize:"單文件大小不能超過 ",lowestPx:"圖片最低像素為（寬*高）："}},en:{hint:"Click or drag the file here to upload",loading:"Uploading…",noSupported:"Browser is not supported, please use IE10+ or other browsers",success:"Upload success",fail:"Upload failed",preview:"Preview",btn:{off:"Cancel",close:"Close",back:"Back",save:"Save"},error:{onlyImg:"Image only",outOfSize:"Image exceeds size limit: ",lowestPx:"Image's size is too low. Expected at least: "}},ro:{hint:"Atinge sau trage fișierul aici",loading:"Se încarcă",noSupported:"Browser-ul tău nu suportă acest feature. Te rugăm încearcă cu alt browser.",success:"S-a încărcat cu succes",fail:"A apărut o problemă la încărcare",preview:"Previzualizează",btn:{off:"Anulează",close:"Închide",back:"Înapoi",save:"Salvează"},error:{onlyImg:"Doar imagini",outOfSize:"Imaginea depășește limita de: ",loewstPx:"Imaginea este prea mică; Minim: "}},ru:{hint:"Нажмите, или перетащите файл в это окно",loading:"Загружаю……",noSupported:"Ваш браузер не поддерживается, пожалуйста, используйте IE10 + или другие браузеры",success:"Загрузка выполнена успешно",fail:"Ошибка загрузки",preview:"Предпросмотр",btn:{off:"Отменить",close:"Закрыть",back:"Назад",save:"Сохранить"},error:{onlyImg:"Только изображения",outOfSize:"Изображение превышает предельный размер: ",lowestPx:"Минимальный размер изображения: "}},"pt-br":{hint:"Clique ou arraste o arquivo aqui para carregar",loading:"Carregando…",noSupported:"Browser não suportado, use o IE10+ ou outro browser",success:"Sucesso ao carregar imagem",fail:"Falha ao carregar imagem",preview:"Pré-visualizar",btn:{off:"Cancelar",close:"Fechar",back:"Voltar",save:"Salvar"},error:{onlyImg:"Apenas imagens",outOfSize:"A imagem excede o limite de tamanho: ",lowestPx:"O tamanho da imagem é muito pequeno. Tamanho mínimo: "}},fr:{hint:"Cliquez ou glissez le fichier ici.",loading:"Téléchargement…",noSupported:"Votre navigateur n'est pas supporté. Utilisez IE10 + ou un autre navigateur s'il vous plaît.",success:"Téléchargement réussit",fail:"Téléchargement echoué",preview:"Aperçu",btn:{off:"Annuler",close:"Fermer",back:"Retour",save:"Enregistrer"},error:{onlyImg:"Image uniquement",outOfSize:"L'image sélectionnée dépasse la taille maximum: ",lowestPx:"L'image sélectionnée est trop petite. Dimensions attendues: "}},nl:{hint:"Klik hier of sleep een afbeelding in dit vlak",loading:"Uploaden…",noSupported:"Je browser wordt helaas niet ondersteund. Gebruik IE10+ of een andere browser.",success:"Upload succesvol",fail:"Upload mislukt",preview:"Voorbeeld",btn:{off:"Annuleren",close:"Sluiten",back:"Terug",save:"Opslaan"},error:{onlyImg:"Alleen afbeeldingen",outOfSize:"De afbeelding is groter dan: ",lowestPx:"De afbeelding is te klein! Minimale afmetingen: "}},tr:{hint:"Tıkla veya yüklemek istediğini buraya sürükle",loading:"Yükleniyor…",noSupported:"Tarayıcı desteklenmiyor, lütfen IE10+ veya farklı tarayıcı kullanın",success:"Yükleme başarılı",fail:"Yüklemede hata oluştu",preview:"Önizle",btn:{off:"İptal",close:"Kapat",back:"Geri",save:"Kaydet"},error:{onlyImg:"Sadece resim",outOfSize:"Resim yükleme limitini aşıyor: ",lowestPx:"Resmin boyutu çok küçük. En az olması gereken: "}},"es-MX":{hint:"Selecciona o arrastra una imagen",loading:"Subiendo...",noSupported:"Tu navegador no es soportado, porfavor usa IE10+ u otros navegadores mas recientes",success:"Subido exitosamente",fail:"Sucedió un error",preview:"Vista previa",btn:{off:"Cancelar",close:"Cerrar",back:"Atras",save:"Guardar"},error:{onlyImg:"Unicamente imagenes",outOfSize:"La imagen excede el tamaño maximo:",lowestPx:"La imagen es demasiado pequeño. Se espera por lo menos:"}},de:{hint:"Klick hier oder zieh eine Datei hier rein zum Hochladen",loading:"Hochladen…",noSupported:"Browser wird nicht unterstützt, bitte verwende IE10+ oder andere Browser",success:"Upload erfolgreich",fail:"Upload fehlgeschlagen",preview:"Vorschau",btn:{off:"Abbrechen",close:"Schließen",back:"Zurück",save:"Speichern"},error:{onlyImg:"Nur Bilder",outOfSize:"Das Bild ist zu groß: ",lowestPx:"Das Bild ist zu klein. Mindestens: "}},ja:{hint:"クリック・ドラッグしてファイルをアップロード",loading:"アップロード中...",noSupported:"このブラウザは対応されていません。IE10+かその他の主要ブラウザをお使いください。",success:"アップロード成功",fail:"アップロード失敗",preview:"プレビュー",btn:{off:"キャンセル",close:"閉じる",back:"戻る",save:"保存"},error:{onlyImg:"画像のみ",outOfSize:"画像サイズが上限を超えています。上限: ",lowestPx:"画像が小さすぎます。最小サイズ: "}}},I={jpg:"image/jpeg",png:"image/png",gif:"image/gif",svg:"image/svg+xml",psd:"image/photoshop"};const k={props:{field:{type:String,default:"avatar"},ki:{default:0},value:{default:!0},url:{type:String,default:""},params:{type:Object,default:null},headers:{type:Object,default:null},width:{type:Number,default:200},height:{type:Number,default:200},noRotate:{type:Boolean,default:!0},noCircle:{type:Boolean,default:!1},noSquare:{type:Boolean,default:!1},maxSize:{type:Number,default:10240},langType:{type:String,default:"zh"},langExt:{type:Object,default:null},withCredentials:{type:Boolean,default:!1}},data(){const{imgFormat:e,langType:t,langExt:a,width:o,height:i}=this;let r=!0;const s=-1===["jpg","png"].indexOf(e)?"jpg":e,n=S[t]?S[t]:S.en,l=I[s];return this.imgFormat=s,a&&Object.assign(n,a),"function"!=typeof FormData&&(r=!1),{mime:l,lang:n,isSupported:r,isSupportTouch:document.hasOwnProperty("ontouchstart"),step:1,loading:0,progress:0,hasError:!1,errorMsg:"",ratio:o/i,sourceImg:null,sourceImgUrl:"",createImgUrl:"",sourceImgMouseDown:{on:!1,mX:0,mY:0,x:0,y:0},previewContainer:{width:100,height:100},sourceImgContainer:{width:240,height:184},scale:{zoomAddOn:!1,zoomSubOn:!1,range:1,rotateLeft:!1,rotateRight:!1,degree:0,x:0,y:0,width:0,height:0,maxWidth:0,maxHeight:0,minWidth:0,minHeight:0,naturalWidth:0,naturalHeight:0}}},computed:{progressStyle(){const{progress:e}=this;return{width:e+"%"}},sourceImgStyle(){const{scale:e,sourceImgMasking:t}=this;return{top:e.y+t.y+"px",left:e.x+t.x+"px",width:e.width+"px",height:e.height+"px",transform:"rotate("+e.degree+"deg)","-ms-transform":"rotate("+e.degree+"deg)","-moz-transform":"rotate("+e.degree+"deg)","-webkit-transform":"rotate("+e.degree+"deg)","-o-transform":"rotate("+e.degree+"deg)"}},sourceImgMasking(){const{width:e,height:t,ratio:a,sourceImgContainer:o}=this,i=o,r=i.width/i.height;let s=0,n=0,l=i.width,c=i.height,u=1;return a<r&&(u=i.height/t,l=i.height*a,s=(i.width-l)/2),a>r&&(u=i.width/e,c=i.width/a,n=(i.height-c)/2),{scale:u,x:s,y:n,width:l,height:c}},sourceImgShadeStyle(){const{sourceImgMasking:e,sourceImgContainer:t}=this,a=t,o=e;return{width:(o.width==a.width?o.width:(a.width-o.width)/2)+"px",height:(o.height==a.height?o.height:(a.height-o.height)/2)+"px"}},previewStyle(){const{width:e,height:t,ratio:a,previewContainer:o}=this,i=o;let r=i.width,s=i.height;const n=r/s;return a<n&&(r=i.height*a),a>n&&(s=i.width/a),{width:r+"px",height:s+"px"}}},watch:{value(e){e&&1!=this.loading&&this.reset()}},methods:{ripple(e){!function(e,t){var a=Object.assign({ele:e.target,type:"hit",bgc:"rgba(0, 0, 0, 0.15)"},t),o=a.ele;if(o){var i=o.getBoundingClientRect(),r=o.querySelector(".e-ripple");r?r.className="e-ripple":((r=document.createElement("span")).className="e-ripple",r.style.height=r.style.width=Math.max(i.width,i.height)+"px",o.appendChild(r)),"center"===a.type?(r.style.top=i.height/2-r.offsetHeight/2+"px",r.style.left=i.width/2-r.offsetWidth/2+"px"):(r.style.top=e.pageY-i.top-r.offsetHeight/2-document.body.scrollTop+"px",r.style.left=e.pageX-i.left-r.offsetWidth/2-document.body.scrollLeft+"px"),r.style.backgroundColor=a.bgc,r.className="e-ripple z-active"}}(e)},off(){setTimeout((()=>{this.$emit("input",!1),this.$emit("close"),3==this.step&&2==this.loading&&this.setStep(1)}),200)},setStep(e){setTimeout((()=>{this.step=e}),200)},preventDefault:e=>(e.preventDefault(),!1),handleClick(e){1!==this.loading&&e.target!==this.$refs.fileinput&&(e.preventDefault(),document.activeElement!==this.$refs&&this.$refs.fileinput.click())},handleChange(e){if(e.preventDefault(),1!==this.loading){const t=e.target.files||e.dataTransfer.files;this.reset(),this.checkFile(t[0])&&this.setSourceImg(t[0])}},checkFile(e){let t=this,{lang:a,maxSize:o}=t;return-1===e.type.indexOf("image")?(t.hasError=!0,t.errorMsg=a.error.onlyImg,!1):!(e.size/1024>o)||(t.hasError=!0,t.errorMsg=a.error.outOfSize+o+"kb",!1)},reset(){const e=this;e.loading=0,e.hasError=!1,e.errorMsg="",e.progress=0},setSourceImg(e){let t=this,a=new FileReader;a.onload=function(e){t.sourceImgUrl=a.result,t.startCrop()},a.readAsDataURL(e)},startCrop(){let e=this,{width:t,height:a,ratio:o,scale:i,sourceImgUrl:r,sourceImgMasking:s,lang:n}=e,l=s,c=new Image;c.src=r,c.onload=function(){let r=c.naturalWidth,s=c.naturalHeight,u=r/s,p=l.width,d=l.height,g=0,h=0;if(r<t||s<a)return e.hasError=!0,e.errorMsg=n.error.lowestPx+t+"*"+a,!1;o>u&&(d=p/u,h=(l.height-d)/2),o<u&&(p=d*u,g=(l.width-p)/2),i.range=0,i.x=g,i.y=h,i.width=p,i.height=d,i.degree=0,i.minWidth=p,i.minHeight=d,i.maxWidth=r*l.scale,i.maxHeight=s*l.scale,i.naturalWidth=r,i.naturalHeight=s,e.sourceImg=c,e.createImg(),e.setStep(2)}},imgStartMove(e){if(e.preventDefault(),this.isSupportTouch&&!e.targetTouches)return!1;let t=e.targetTouches?e.targetTouches[0]:e,{sourceImgMouseDown:a,scale:o}=this,i=a;i.mX=t.screenX,i.mY=t.screenY,i.x=o.x,i.y=o.y,i.on=!0},imgMove(e){if(e.preventDefault(),this.isSupportTouch&&!e.targetTouches)return!1;let t=e.targetTouches?e.targetTouches[0]:e,{sourceImgMouseDown:{on:a,mX:o,mY:i,x:r,y:s},scale:n,sourceImgMasking:l}=this,c=l,u=r+(t.screenX-o),p=s+(t.screenY-i);a&&(u>0&&(u=0),p>0&&(p=0),u<c.width-n.width&&(u=c.width-n.width),p<c.height-n.height&&(p=c.height-n.height),n.x=u,n.y=p)},startRotateRight(e){let t=this,{scale:a}=t;a.rotateRight=!0,function e(){if(a.rotateRight){const o=++a.degree;t.createImg(o),setTimeout((function(){e()}),60)}}()},startRotateLeft(e){let t=this,{scale:a}=t;a.rotateLeft=!0,function e(){if(a.rotateLeft){const o=--a.degree;t.createImg(o),setTimeout((function(){e()}),60)}}()},endRotate(){const{scale:e}=this;e.rotateLeft=!1,e.rotateRight=!1},startZoomAdd(e){let t=this,{scale:a}=t;a.zoomAddOn=!0,function e(){if(a.zoomAddOn){const o=a.range>=100?100:++a.range;t.zoomImg(o),setTimeout((function(){e()}),60)}}()},endZoomAdd(e){this.scale.zoomAddOn=!1},startZoomSub(e){let t=this,{scale:a}=t;a.zoomSubOn=!0,function e(){if(a.zoomSubOn){const o=a.range<=0?0:--a.range;t.zoomImg(o),setTimeout((function(){e()}),60)}}()},endZoomSub(e){const{scale:t}=this;t.zoomSubOn=!1},zoomChange(e){this.zoomImg(e.target.value)},zoomImg(e){const t=this,{sourceImgMasking:a,sourceImgMouseDown:o,scale:i}=this,{maxWidth:r,maxHeight:s,minWidth:n,minHeight:l,width:c,height:u,x:p,y:d,range:g}=i,h=a,m=h.width,f=h.height,v=n+(r-n)*e/100,w=l+(s-l)*e/100;let y=m/2-v/c*(m/2-p),b=f/2-w/u*(f/2-d);y>0&&(y=0),b>0&&(b=0),y<m-v&&(y=m-v),b<f-w&&(b=f-w),i.x=y,i.y=b,i.width=v,i.height=w,i.range=e,setTimeout((function(){i.range==e&&t.createImg()}),300)},createImg(e){let t=this,{mime:a,sourceImg:o,scale:{x:i,y:r,width:s,height:n,degree:l},sourceImgMasking:{scale:c}}=t,u=t.$refs.canvas,p=u.getContext("2d");e&&(t.sourceImgMouseDown.on=!1),u.width=t.width,u.height=t.height,p.clearRect(0,0,t.width,t.height),p.fillStyle="#fff",p.fillRect(0,0,t.width,t.height),p.translate(.5*t.width,.5*t.height),p.rotate(Math.PI*l/180),p.translate(.5*-t.width,.5*-t.height),p.drawImage(o,i/c,r/c,s/c,n/c),t.createImgUrl=u.toDataURL(a)},prepareUpload(){const{url:e,createImgUrl:t,field:a,ki:o}=this;this.$emit("crop-success",t,a,o),"string"==typeof e&&e?this.upload():this.off()},upload(){let e=this,{lang:a,imgFormat:o,mime:i,url:r,params:s,headers:n,field:l,ki:c,createImgUrl:u,withCredentials:p}=this,d=new FormData;d.append(l,function(e,t){e=e.split(",")[1],e=window.atob(e);for(var a=new Uint8Array(e.length),o=0;o<e.length;o++)a[o]=e.charCodeAt(o);return new Blob([a],{type:t})}(u,i),l+"."+o),"object"==typeof s&&s&&Object.keys(s).forEach((e=>{d.append(e,s[e])})),e.reset(),e.loading=1,e.setStep(3),t({url:r,method:"post",data:d}).then((t=>{e.loading=2,e.$emit("crop-upload-success",t.data)})).catch((t=>{e.value&&(e.loading=3,e.hasError=!0,e.errorMsg=a.fail,e.$emit("crop-upload-fail",t,l,c))}))}},created(){document.addEventListener("keyup",(e=>{!this.value||"Escape"!=e.key&&27!=e.keyCode||this.off()}))}},x={class:"vue-image-crop-upload"},M={class:"vicp-wrap"},D=[s("i",{class:"vicp-icon4"},null,-1)],z={class:"vicp-step1"},C={class:"vicp-icon1"},R=[s("i",{class:"vicp-icon1-arrow"},null,-1),s("i",{class:"vicp-icon1-body"},null,-1),s("i",{class:"vicp-icon1-bottom"},null,-1)],E={class:"vicp-error"},O=s("i",{class:"vicp-icon2"},null,-1),T={class:"vicp-operate"},F={key:0,class:"vicp-step2"},U={class:"vicp-crop"},A={class:"vicp-crop-left"},_={class:"vicp-img-container"},P=["src"],j={class:"vicp-range"},$=["value"],Z={key:0,class:"vicp-rotate"},B={class:"vicp-crop-right"},L={class:"vicp-preview"},q={key:0,class:"vicp-preview-item"},H=["src"],V={key:1,class:"vicp-preview-item vicp-preview-item-circle"},W=["src"],N={class:"vicp-operate"},K={key:1,class:"vicp-step3"},Y={class:"vicp-upload"},X={class:"vicp-progress-wrap"},G={class:"vicp-error"},J=s("i",{class:"vicp-icon2"},null,-1),Q={class:"vicp-success"},ee=s("i",{class:"vicp-icon3"},null,-1),te={class:"vicp-operate"},ae=["width","height"];const oe={active:!0,name:"",email:"",password:"",id:void 0,avatar:"/static/img/default-avatar.jpg"},ie={name:"UserDetail",components:{MDinput:y,Sticky:b,ImageCropper:e(k,[["render",function(e,t,p,d,g,h){return a((i(),r("div",x,[s("div",M,[s("div",{class:"vicp-close",onClick:t[0]||(t[0]=(...e)=>h.off&&h.off(...e))},D),a(s("div",z,[s("div",{class:"vicp-drop-area",onDragleave:t[2]||(t[2]=(...e)=>h.preventDefault&&h.preventDefault(...e)),onDragover:t[3]||(t[3]=(...e)=>h.preventDefault&&h.preventDefault(...e)),onDragenter:t[4]||(t[4]=(...e)=>h.preventDefault&&h.preventDefault(...e)),onClick:t[5]||(t[5]=(...e)=>h.handleClick&&h.handleClick(...e)),onDrop:t[6]||(t[6]=(...e)=>h.handleChange&&h.handleChange(...e))},[a(s("i",C,R,512),[[o,1!=g.loading]]),a(s("span",{class:"vicp-hint"},n(g.lang.hint),513),[[o,1!==g.loading]]),a(s("span",{class:"vicp-no-supported-hint"},n(g.lang.noSupported),513),[[o,!g.isSupported]]),1==g.step?a((i(),r("input",{key:0,ref:"fileinput",type:"file",onChange:t[1]||(t[1]=(...e)=>h.handleChange&&h.handleChange(...e))},null,544)),[[o,!1]]):l("v-if",!0)],32),a(s("div",E,[O,c(" "+n(g.errorMsg),1)],512),[[o,g.hasError]]),s("div",T,[s("a",{onClick:t[7]||(t[7]=(...e)=>h.off&&h.off(...e)),onMousedown:t[8]||(t[8]=(...e)=>h.ripple&&h.ripple(...e))},n(g.lang.btn.off),33)])],512),[[o,1==g.step]]),2==g.step?(i(),r("div",F,[s("div",U,[a(s("div",A,[s("div",_,[s("img",{ref:"img",src:g.sourceImgUrl,style:u(h.sourceImgStyle),class:"vicp-img",draggable:"false",onDrag:t[9]||(t[9]=(...e)=>h.preventDefault&&h.preventDefault(...e)),onDragstart:t[10]||(t[10]=(...e)=>h.preventDefault&&h.preventDefault(...e)),onDragend:t[11]||(t[11]=(...e)=>h.preventDefault&&h.preventDefault(...e)),onDragleave:t[12]||(t[12]=(...e)=>h.preventDefault&&h.preventDefault(...e)),onDragover:t[13]||(t[13]=(...e)=>h.preventDefault&&h.preventDefault(...e)),onDragenter:t[14]||(t[14]=(...e)=>h.preventDefault&&h.preventDefault(...e)),onDrop:t[15]||(t[15]=(...e)=>h.preventDefault&&h.preventDefault(...e)),onTouchstart:t[16]||(t[16]=(...e)=>h.imgStartMove&&h.imgStartMove(...e)),onTouchmove:t[17]||(t[17]=(...e)=>h.imgMove&&h.imgMove(...e)),onTouchend:t[18]||(t[18]=(...e)=>h.createImg&&h.createImg(...e)),onTouchcancel:t[19]||(t[19]=(...e)=>h.createImg&&h.createImg(...e)),onMousedown:t[20]||(t[20]=(...e)=>h.imgStartMove&&h.imgStartMove(...e)),onMousemove:t[21]||(t[21]=(...e)=>h.imgMove&&h.imgMove(...e)),onMouseup:t[22]||(t[22]=(...e)=>h.createImg&&h.createImg(...e)),onMouseout:t[23]||(t[23]=(...e)=>h.createImg&&h.createImg(...e))},null,44,P),s("div",{style:u(h.sourceImgShadeStyle),class:"vicp-img-shade vicp-img-shade-1"},null,4),s("div",{style:u(h.sourceImgShadeStyle),class:"vicp-img-shade vicp-img-shade-2"},null,4)]),s("div",j,[s("input",{value:g.scale.range,type:"range",step:"1",min:"0",max:"100",onInput:t[24]||(t[24]=(...e)=>h.zoomChange&&h.zoomChange(...e))},null,40,$),s("i",{class:"vicp-icon5",onMousedown:t[25]||(t[25]=(...e)=>h.startZoomSub&&h.startZoomSub(...e)),onMouseout:t[26]||(t[26]=(...e)=>h.endZoomSub&&h.endZoomSub(...e)),onMouseup:t[27]||(t[27]=(...e)=>h.endZoomSub&&h.endZoomSub(...e))},null,32),s("i",{class:"vicp-icon6",onMousedown:t[28]||(t[28]=(...e)=>h.startZoomAdd&&h.startZoomAdd(...e)),onMouseout:t[29]||(t[29]=(...e)=>h.endZoomAdd&&h.endZoomAdd(...e)),onMouseup:t[30]||(t[30]=(...e)=>h.endZoomAdd&&h.endZoomAdd(...e))},null,32)]),p.noRotate?l("v-if",!0):(i(),r("div",Z,[s("i",{onMousedown:t[31]||(t[31]=(...e)=>h.startRotateLeft&&h.startRotateLeft(...e)),onMouseout:t[32]||(t[32]=(...e)=>h.endRotate&&h.endRotate(...e)),onMouseup:t[33]||(t[33]=(...e)=>h.endRotate&&h.endRotate(...e))},"↺",32),s("i",{onMousedown:t[34]||(t[34]=(...e)=>h.startRotateRight&&h.startRotateRight(...e)),onMouseout:t[35]||(t[35]=(...e)=>h.endRotate&&h.endRotate(...e)),onMouseup:t[36]||(t[36]=(...e)=>h.endRotate&&h.endRotate(...e))},"↻",32)]))],512),[[o,!0]]),a(s("div",B,[s("div",L,[p.noSquare?l("v-if",!0):(i(),r("div",q,[s("img",{src:g.createImgUrl,style:u(h.previewStyle)},null,12,H),s("span",null,n(g.lang.preview),1)])),p.noCircle?l("v-if",!0):(i(),r("div",V,[s("img",{src:g.createImgUrl,style:u(h.previewStyle)},null,12,W),s("span",null,n(g.lang.preview),1)]))])],512),[[o,!0]])]),s("div",N,[s("a",{onClick:t[37]||(t[37]=e=>h.setStep(1)),onMousedown:t[38]||(t[38]=(...e)=>h.ripple&&h.ripple(...e))},n(g.lang.btn.back),33),s("a",{class:"vicp-operate-btn",onClick:t[39]||(t[39]=(...e)=>h.prepareUpload&&h.prepareUpload(...e)),onMousedown:t[40]||(t[40]=(...e)=>h.ripple&&h.ripple(...e))},n(g.lang.btn.save),33)])])):l("v-if",!0),3==g.step?(i(),r("div",K,[s("div",Y,[a(s("span",{class:"vicp-loading"},n(g.lang.loading),513),[[o,1===g.loading]]),s("div",X,[a(s("span",{style:u(h.progressStyle),class:"vicp-progress"},null,4),[[o,1===g.loading]])]),a(s("div",G,[J,c(" "+n(g.errorMsg),1)],512),[[o,g.hasError]]),a(s("div",Q,[ee,c(" "+n(g.lang.success),1)],512),[[o,2===g.loading]])]),s("div",te,[s("a",{onClick:t[41]||(t[41]=e=>h.setStep(2)),onMousedown:t[42]||(t[42]=(...e)=>h.ripple&&h.ripple(...e))},n(g.lang.btn.back),33),s("a",{onClick:t[43]||(t[43]=(...e)=>h.off&&h.off(...e)),onMousedown:t[44]||(t[44]=(...e)=>h.ripple&&h.ripple(...e))},n(g.lang.btn.close),33)])])):l("v-if",!0),a(s("canvas",{ref:"canvas",width:p.width,height:p.height},null,8,ae),[[o,!1]])])],512)),[[o,p.value]])}]])},props:{isEdit:{type:Boolean,default:!1}},data(){const e=(e,t,a)=>{""===t?(this.$message({message:e.field+"为必传项",type:"error"}),a(new Error(e.field+"为必传项"))):a()};return{userForm:Object.assign({},oe),loading:!1,rules:{name:[{validator:e}],email:[{validator:e}]},tempRoute:{},imagecropperShow:!1,imagecropperKey:0,image:""}},created(){if(this.isEdit){const e=this.$route.params&&this.$route.params.id;this.fetchData(e)}else this.userForm=Object.assign({},oe);this.tempRoute=Object.assign({},this.$route)},methods:{fetchData(e){p(e).then((e=>{this.userForm=e.data,this.userForm.password="",this.userForm.avatar&&(this.image=this.userForm.avatar_url),this.setTagsViewTitle()})).catch((e=>{}))},setTagsViewTitle(){const e=Object.assign({},this.tempRoute,{title:`编辑用户-${this.userForm.id}`});this.$store.dispatch("tagsView/updateVisitedView",e)},cropSuccess(e){this.imagecropperShow=!1,this.imagecropperKey=this.imagecropperKey+1,this.image=e.files.avatar,this.userForm.avatar=e.files.avatar_path},close(){this.imagecropperShow=!1},submitForm(e){this.$refs.userFormRef.validate(((t,a)=>{if(!t)return!1;{let t;if(this.loading=!0,this.isEdit){let a=this.userForm.id;t=d(a,e)}else t=g(this.userForm);let a=this;t.then((()=>{a.$notify({title:"成功",message:"用户发布成功",type:"success",duration:2e3}),this.loading=!1,this.isEdit||this.$router.push("/user/list?refresh=1"),this.$store.dispatch("SetNewAvatar",[fothis.userForm.name,a.image])})).catch((e=>{}))}}))}}},re={class:"createPost-container"},se=c("Active"),ne={class:"createPost-main-container"},le=c(" Name "),ce={class:"avatar"},ue=["src"],pe=c("改变头像"),de=c(" Email "),ge=c(" Password ");var he=e(ie,[["render",function(e,t,l,u,p,d){const g=h("el-checkbox"),y=h("el-button"),b=h("sticky"),S=h("MDinput"),I=h("el-form-item"),k=h("el-col"),x=h("el-row"),M=h("image-cropper"),D=h("el-form"),z=m("loading");return i(),r("div",re,[f(D,{ref:"userFormRef",model:p.userForm,rules:p.rules,class:"form-container"},{default:v((()=>[f(b,{"class-name":"sub-navbar draft"},{default:v((()=>[f(g,{modelValue:p.userForm.active,"onUpdate:modelValue":t[0]||(t[0]=e=>p.userForm.active=e)},{default:v((()=>[se])),_:1},8,["modelValue"]),a((i(),w(y,{style:{"margin-left":"10px","margin-top":"-3px"},type:"success",onClick:d.submitForm},{default:v((()=>[c(n(l.isEdit?"更新":"新增"),1)])),_:1},8,["onClick"])),[[z,p.loading]])])),_:1}),s("div",ne,[f(x,null,{default:v((()=>[f(k,{span:24},{default:v((()=>[f(I,{style:{"margin-bottom":"40px"},prop:"name"},{default:v((()=>[f(S,{value:p.userForm.name,"onUpdate:value":t[1]||(t[1]=e=>p.userForm.name=e),maxlength:100,name:"name",required:"",disabled:l.isEdit},{default:v((()=>[le])),_:1},8,["value","disabled"])])),_:1})])),_:1})])),_:1}),f(x,null,{default:v((()=>[s("div",ce,[s("img",{src:p.image,class:"avatar"},null,8,ue),f(y,{type:"primary",icon:"upload",style:{position:"absolute",bottom:"15px","margin-left":"40px"},onClick:t[2]||(t[2]=e=>p.imagecropperShow=!0)},{default:v((()=>[pe])),_:1}),a((i(),w(M,{width:300,height:300,key:p.imagecropperKey,url:"/api/upload","lang-type":"en",onClose:d.close,onCropUploadSuccess:d.cropSuccess},null,8,["onClose","onCropUploadSuccess"])),[[o,p.imagecropperShow]])])])),_:1}),f(x,null,{default:v((()=>[f(k,{span:24},{default:v((()=>[f(I,{style:{"margin-bottom":"40px"},prop:"email"},{default:v((()=>[f(S,{value:p.userForm.email,"onUpdate:value":t[3]||(t[3]=e=>p.userForm.email=e),maxlength:100,name:"email",required:""},{default:v((()=>[de])),_:1},8,["value"])])),_:1})])),_:1})])),_:1}),f(x,null,{default:v((()=>[f(k,{span:24},{default:v((()=>[f(I,{style:{"margin-bottom":"40px"},prop:"password"},{default:v((()=>[f(S,{value:p.userForm.password,"onUpdate:value":t[4]||(t[4]=e=>p.userForm.password=e),maxlength:100,name:"password",required:""},{default:v((()=>[ge])),_:1},8,["value"])])),_:1})])),_:1})])),_:1})])])),_:1},8,["model","rules"])])}],["__scopeId","data-v-359e3a98"]]);export{he as U};
